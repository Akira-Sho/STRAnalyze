{% extends 'base.html' %}
{% load static %}
{% block title %}投稿リスト | STRANALYZE{% endblock %}
{% block contents %}

<div class="content-info">
  <div class="left-content">
    <img src="{% if item_data.item_photo %}{{ item_data.item_photo.url}}
    {% else %}
      {% static 'images/no_str_image.jpeg' %}
    {% endif %}">
  </div>
  <div class="right-content">
      <ul>
        <li>{{ item_data.item_name }}</li>
        <li>{{ item_data.brand_name }}</li>
        <li>{{ item_data.item_position }}</li>
      </ul>
  </div>
</div>

{% if user.is_authenticated %}
  <p class="review-link"><a href="{% url 'timeline:post_create' item_data.item_url_name  %}">レビューを投稿する→</a></p>
{% else %}
  <p class="post-guid-p color-orange">ログインすればレビューを投稿できるようになります。</p>
{% endif %}



<div class="post-count">投稿数：{{ post_count }}件
</div>
{% if object_list %}
  {% for post in object_list %}
    <div class="contents-box">
      <div class="post-header">
      {% if user.is_authenticated %}
        <div class="post-header-photo">
          <a href="{% url 'accounts:reviewer' post.author.id %}">
          <img src="{% if post.author.thumbnail %}{{ post.author.thumbnail.url }}
          {% else %}
            {% static 'images/no_photo.png' %}
          {% endif %}" class="post-profile-photo">
          </a>
        </div>
        <div class="post-info">
          <ul>
            <li><a class="post-info-link" href="{% url 'accounts:reviewer' post.author.id %}">{{ post.author }}</a></li>
            <li>{{ post.created_at | date:"Y年n月j日 H時" }}</li>
          </ul>
        </div>
      {% else %}
        <div class="post-header-photo">
          <img src="{% if post.author.thumbnail %}{{ post.author.thumbnail.url }}
          {% else %}{% static 'images/no_photo.png' %}
          {% endif %}" class="post-profile-photo">
        </div>
        <div class="post-info">
          <ul>
            <li>{{ post.author }}</li>
            <li>{{ post.created_at | date:"Y年n月j日H時" }}</li>
          </ul>
        </div>
        {% endif %}
      </div>
      <div class="post-contents-text">
      {% if post.text %}
        <p>{{ post.text }}</p>
      {% else %}
        <p>未記入</p>
      {% endif %}
      </div>

      {% if post.post_photo %}
        <img class="post-contents-photo" src="{{ post.post_photo.url }}">
      {% endif %}

      {% if user.is_authenticated %}
        {% if post.author.id == user.id %}
        <div class="button-area">
          <ul>
            <li><a class="btn btn-outline-info btn-sm" href="{% url 'timeline:post_edit' item_data.item_url_name post.pk %}">編集</a></li>
            <li><a class="btn btn-outline-danger btn-sm" href="{% url 'timeline:post_confirm_delete' item_data.item_url_name post.pk %}">削除</a></li>
          </ul>
        </div>
        {% else %}
        <div class="like-area">
          <form method="POST">
          {% csrf_token %}
          {% if post.pk in liked_list %}
            <div id="like" name="{{post.pk}}"><i class="fas fa-lg fa-star star-yellow"></i>
            </div>
          {% else %}
            <div id="like" name="{{post.pk}}"><i class="far fa-lg fa-star star-yellow"></i>
            </div>      
          {% endif %}
          </form>
          <p name="{{post.pk}}-count">{{ post.like_set.count }}</p>
        </div>
        {% endif %}
      {% endif %}
    </div>
  {% endfor %}
<!--↓ページネーション-->
{% include 'pagination.html' %}
{% else %}
{% endif %}
{% endblock %}